# ApplyFollow - Backend Code Review Raporu
# Tarih: 24.01.2026
# HazÄ±rlayan: Gemini CLI (Code Reviewer Agent)

Bu dosya, backend kod tabanÄ±nÄ±n (Java/Spring Boot) detaylÄ± analizi sonucunda oluÅŸturulan bulgularÄ± ve aksiyon planÄ±nÄ± iÃ§erir.

---

## ğŸš¨ 1. P0 - Kritik GÃ¼venlik AÃ§Ä±klarÄ± (ACÄ°L DÃœZELTÄ°LMELÄ°)

### A. Backdoor (Arka KapÄ±)
- **Konum:** `UserService.java` -> `register` metodu.
- **Sorun:** `if (request.email().equalsIgnoreCase("dev.oguzhankaya@gmail.com")) { role = Role.ADMIN; }`
- **Risk:** Kodun iÃ§ine gÃ¶mÃ¼lÃ¼ admin yetkisi. Mail adresi deÄŸiÅŸirse veya kod sÄ±zarsa gÃ¼venlik ihlali yaratÄ±r.
- **Aksiyon:** Bu satÄ±rÄ± sil. Admin atamasÄ±nÄ± veritabanÄ±ndan manuel yap veya gÃ¼venli bir `AdminSeeder` kullan.

### B. IDOR (Yetkisiz Veri EriÅŸimi)
- **Konum:** `ApplicationService.java`, `ApplicationController.java`.
- **Sorun:** `findById` gibi metodlar sadece ID'ye bakÄ±yor. User A, User B'nin baÅŸvuru ID'sini bilirse verisini Ã§ekebilir.
- **Risk:** KullanÄ±cÄ± gizliliÄŸi ihlali (MaaÅŸ, Notlar vb.).
- **Aksiyon:** TÃ¼m veri eriÅŸim metodlarÄ±na `userId` parametresi ekle ve veritabanÄ± sorgusunu `findByIdAndUserId` olarak deÄŸiÅŸtir.

### C. CORS TutarsÄ±zlÄ±ÄŸÄ±
- **Konum:** Controller sÄ±nÄ±flarÄ± (`@CrossOrigin`).
- **Sorun:** `SecurityConfiguration` dinamik ayarlanmÄ±ÅŸken, Controller'larda `http://localhost:3000` statik olarak kalmÄ±ÅŸ.
- **Aksiyon:** Controller'lardaki `@CrossOrigin` anotasyonlarÄ±nÄ± kaldÄ±r, sadece `SecurityConfiguration` Ã¼zerinden yÃ¶net.

---

## âš ï¸ 2. P1 - Mimari ve Stabilite Ä°yileÅŸtirmeleri

### A. Transaction YÃ¶netimi (CV GÃ¼ncelleme)
- **Konum:** `CvService.java` -> `updateCv`
- **Sorun:** "Hepsini sil, yenilerini ekle" (Delete-Insert) mantÄ±ÄŸÄ± kullanÄ±lÄ±yor.
- **Risk:** Insert sÄ±rasÄ±nda hata olursa kullanÄ±cÄ± eski verilerini de kaybeder (Transaction rollback olmazsa). AyrÄ±ca ID tÃ¼ketimi Ã§ok yÃ¼ksek.
- **Aksiyon:** MÃ¼mkÃ¼nse "Varsa gÃ¼ncelle, Yoksa ekle, Listede olmayanÄ± sil" (Merge) mantÄ±ÄŸÄ±na geÃ§. MVP iÃ§in kalabilir ama `@Transactional` olduÄŸundan emin ol.

### B. Email Servisi
- **Konum:** `MailService.java`
- **Sorun:** Kod yorum satÄ±rÄ±na alÄ±nmÄ±ÅŸ (Mock mode).
- **Aksiyon:** Spring Profile (`dev`, `prod`) kullanarak Development ortamÄ±nda log basan, Production ortamÄ±nda mail atan yapÄ±ya geÃ§.

---

## ğŸ§¹ 3. P2 - Kod Kalitesi ve Temizlik

- **DTO:** `AuthResponse` Ã§ok ÅŸiÅŸmiÅŸ. Login sadece token dÃ¶nmeli, profil bilgileri `/api/users/profile` endpointi ile alÄ±nmalÄ±.
- **Magic Strings:** Rol isimleri ("ADMIN", "USER") ve Hata mesajlarÄ± sabitlerde (Constants) tutulmalÄ±.
- **Exception Handling:** `GlobalExceptionHandler` iÃ§inde genel hatalar (`Exception.class`) sadece `printStackTrace()` yapÄ±yor. Loglama kÃ¼tÃ¼phanesi (Slf4j) kullanÄ±lmalÄ±.

---

## ğŸ“… Aksiyon PlanÄ± (SÄ±ralÄ±)

1. [ ] Backdoor kodunu sil (`UserService`).
2. [ ] IDOR aÃ§Ä±ÄŸÄ±nÄ± kapat (`ApplicationService` -> `findByIdAndUserId`).
3. [ ] CORS ayarlarÄ±nÄ± temizle.
4. [ ] Email servisini profile (dev/prod) yapÄ±sÄ±na geÃ§ir.

